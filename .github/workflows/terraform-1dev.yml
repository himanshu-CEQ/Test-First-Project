name: 'checkov-Bridgescan'

on:
  push:
    branches:
    - main
#     paths-ignore:
#     - 'README.md'

jobs:
  terraform:
    name: 'Terraform'
    runs-on: ubuntu-latest
    environment: production

    # Use the Bash shell regardless whether the GitHub Actions runner is ubuntu-latest, macos-latest, or windows-latest
    defaults:
      run:
        shell: bash

    steps:
    # Checkout the repository to the GitHub Actions runner
    - name: Checkout
      uses: actions/checkout@v2
    - name: Build image
      run: docker build -t $IMAGE_NAME

    - name: Scan image
      uses: PaloAltoNetworks/prisma-cloud-scan@v1
      with:

        pcc_console_url: ${{ secrets.PCC_CONSOLE_URL }}
        pcc_user: ${{ secrets.PCC_USER }}
        pcc_pass: ${{ secrets.PCC_PASS }}
        image_name: ${{ env.IMAGE_NAME }}  

    # Install the latest version of Terraform CLI and configure the Terraform CLI configuration file with a Terraform Cloud user API token
#     - name: Setup Terraform
#       uses: hashicorp/setup-terraform@v1
#       with:
#         cli_config_credentials_token: ${{ secrets.TF_API_TOKEN }}
#   Scan_with_BridgeCrew:
#     # The type of runner that the job will run on
#     name: 'bridgecrew_scan'
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v2
#       - name: Set up Python 3.8
#         uses: actions/setup-python@v1
#         with:
#           python-version: 3.8
#       - name: Test with Checkov
#         id: checkov
#         uses: bridgecrewio/checkov-action@master
#         with:
#           checkov: -d .
#           framework: terraform
